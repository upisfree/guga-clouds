# ТЕХНИЧЕСКОЕ ЗАДАНИЕ НА ОБЛАКА В ГУГЕ

Необходимо адаптировать и оптимизировать шейдер с Shadertoy для three.js. [Ссылка на шейдер](https://www.shadertoy.com/view/ll2SWd).

Я собрал небольшой демо проект с моими наработками по облакам. Это простой проект на three.js с несколькими объектами и контролами камеры (клик по экрану чтобы крутить камерой, WASD для полета). Внутри лежат два класса:
1. `CloudsShadertoy` — портированный на three.js шейдер. Я перенес его как есть с минимальными доработками. Можно использовать как стартовую точку. [Ссылка на демо](https://raw.githack.com/upisfree/guga-clouds/9f8571eb74af091378cc5edb9cbfc859a743d9af/index.html?shadertoy), [ссылка на класс](https://github.com/upisfree/guga-clouds/blob/master/src/clouds-shadertoy.js).
2. `CloudsUpisfree` — моя попытка адаптации. Я портировал шейдер с Shadertoy в three.js, адаптировал его к движению и повороту камеры, а также попытался его оптимизировать. С движением возникли проблемы: неправильный скейл облаков. Я попытался переписать шум с glsl на js, т.к шум статичный и нет смысла высчитывать его каждый раз в фрагментном шейдере. Я переписал код шума (не уверен что верно) и попробовал писать его в DataTexture, которую передал в шейдер, но у меня возникли проблемы с координатами текстуры. Также, не работает z-buffer. [Ссылка на демо](https://raw.githack.com/upisfree/guga-clouds/9f8571eb74af091378cc5edb9cbfc859a743d9af/index.html?upisfree), [ссылка на класс](https://github.com/upisfree/guga-clouds/blob/master/src/clouds-upisfree.js).



Что нужно сделать:
* нужно портировать шейдер с Shadertoy на three.js, шейдер должен быть как ShaderMaterial
* облака должны корректно реагировать на камеру как обычный 3д объект: при движении камеры — двигаться, при повороте — поворачиваться
* облака должны поддерживать z-buffer, то есть если часть объекта за облаком, то она должна перекрываться им
* облака должны поддерживать fog
* сейчас фон в шейдере зеленый, он должен быть прозрачный фон (имеется в виду небо)
* шейдер должен быть производительным и выдавать 180 фпс на десктопе и хотя бы 60 на телефоне. При этом не должна пострадать визуальная часть. Если ради оптимизации нужно отказаться от какой-то части визуала, это ок
* нужно реализовать настройки визуала шейдера, которые можно отключать, чтобы увеличить производительность

Идеи по оптимизации:
* реализовать что-то типа LOD: рендерить облака вблизи камеры в хорошем качестве, а вдали — хуже
* перенести генерацию шума из glsl в js?
* убрать чтение из текстуры?
* научиться регулировать разрешение или плотность пикселей?
* ухудшить качество raymarching?

Было бы круто, если получится:
* генерация шума в javascript, чтобы можно было генерировать дырки в облаках. Таким образом, можно будет сгенерировать облака и коллизии для физического движка, чтобы можно было ходить по облакам и проваливаться в дырки
